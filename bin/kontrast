#!/usr/bin/env ruby
begin
    require "rubygems"
    require "chalcogen"
rescue LoadError => e
    puts "Could not load Chalcogen."
    raise e
end
require "thor"

module Chalcogen
    class CLI < Thor
        desc "run_tests CONFIG_FILE", "Run Chalcogen test suite"
        def run_tests(config)
            load_config(config)
            Chalcogen.run
        end

        desc "make_gallery CONFIG_FILE PATH", "Create gallery given a path of test results"
        def make_gallery(config, path = nil)
            load_config(config)

            # We're only allowed to give no path in the remote case
            if path.nil? && !Chalcogen.configuration.remote
                raise Exception.new("You can't omit a path when running in remote mode.")
            end

            Chalcogen.make_gallery(path)
        end

        desc "local_run CONFIG_FILE", "Run Chalcogen locally"
        def local_run(config)
            load_config(config)

            # Run Chalcogen
            Chalcogen.run
            Chalcogen.make_gallery(Chalcogen.path)
        end

        private
            def load_config(config)
                begin
                    require config
                rescue LoadError => e
                    puts "Could not load the Chalcogen configuration!"
                    raise e
                end
            end
    end
end

Chalcogen::CLI.start(ARGV)
